{% extends "layout.html" %}
{% load static %}

{% block title %} Create Campaign {% endblock %}

{% block content %}
<br><br><br>
<h2 class="text-center mb-4" style="color: #611800;">Campaign Creation Page (Admin Only)</h2>
<div class="row">
    <!-- Left Column: Existing Campaigns -->
    <div class="col-md-4">
        <h3>Existing Campaigns</h3>
        <ul class="list-group" id="campaign-list">
            {% for campaign in campaigns %}
                <li class="list-group-item">
                    {% if campaign.image %}
                        <img src="{{ campaign.image.url }}" alt="{{ campaign.title }}" style="width: 100%; height: auto;">
                    {% endif %}
                    <h5>{{ campaign.title }}</h5>
                    <p>{{ campaign.description|truncatewords:20 }}</p>
                    <p><strong>Points:</strong> {{ campaign.points }}</p> 
                    <small>Start Date: {{ campaign.start_date }}</small><br>
                    <small>End Date: {{ campaign.end_date }}</small>
                </li>
            {% endfor %}
        </ul>
        <!-- Load More and Show Less Buttons -->
        <button id="load-more" class="btn btn-primary mt-3" data-offset="2">Load More</button>
        <button id="show-less" class="btn btn-primary mt-3" style="display: none;">Show Less</button>
        
    </div>
    
    
    

    <!-- Right Column: Campaign Creation Form -->
    <div class="col-md-8">
        <h3>Create a New Campaign</h3>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="title">Campaign Title</label>
                <input type="text" class="form-control" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
            </div>
            <div class="form-group">
                <label for="points">Points</label>
                <input type="number" class="form-control" id="points" name="points" min="0" required>
            </div>            
            <div class="form-group">
                <label for="start_date">Start Date</label>
                <input type="date" class="form-control" id="start_date" name="start_date" required>
            </div>
            <div class="form-group">
                <label for="end_date">End Date</label>
                <input type="date" class="form-control" id="end_date" name="end_date" required>
            </div>
            <div class="form-group">
                <label for="image">Campaign Image</label>
                <input type="file" class="form-control-file" id="image" name="image">
            </div>
            <button type="submit" class="btn btn-primary">Create Campaign</button>
        </form>
    </div>    
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const totalCampaigns = {{ total_campaigns }};  // Get total campaign count from the view
    
        document.getElementById('load-more').addEventListener('click', function() {
            const offset = parseInt(this.getAttribute('data-offset'));
            
            fetch(`/create-campaign/load_more/?offset=${offset}`)
                .then(response => response.json())
                .then(data => {
                    const campaignList = document.getElementById('campaign-list');
                    data.campaigns.forEach(campaign => {
                        const item = document.createElement('li');
                        item.className = 'list-group-item additional-campaign';
                        item.innerHTML = `
                            ${campaign.image_url ? `<img src="${campaign.image_url}" alt="${campaign.title}" style="width: 100%; height: auto;">` : ''}
                            <h5>${campaign.title}</h5>
                            <p>${campaign.description.substring(0, 100)}...</p>
                            <p><strong>Points:</strong> ${campaign.points}</p>
                            <small>Start Date: ${campaign.start_date}</small><br>
                            <small>End Date: ${campaign.end_date}</small>
                        `;
                        campaignList.appendChild(item);
                    });
    
                    // Update offset for the next load
                    const newOffset = offset + data.campaigns.length;
                    this.setAttribute('data-offset', newOffset);
    
                    // Check if we've loaded all campaigns
                    if (newOffset >= totalCampaigns) {
                        this.style.display = 'none';  // Hide Load More button
                    }
    
                    // Show "Show Less" button after loading more items
                    document.getElementById('show-less').style.display = 'inline-block';
                });
        });
    
        document.getElementById('show-less').addEventListener('click', function() {
            // Remove additional campaigns
            const additionalCampaigns = document.querySelectorAll('.additional-campaign');
            additionalCampaigns.forEach(item => item.remove());
    
            // Reset the offset and toggle buttons
            document.getElementById('load-more').setAttribute('data-offset', 2);
            document.getElementById('load-more').style.display = 'inline-block'; // Show Load More again
            this.style.display = 'none';  // Hide Show Less button
        });
    });
    </script>    
{% endblock %}

